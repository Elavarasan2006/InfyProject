<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edu2Job - Analytics & Visualizations</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
            border-bottom: 1px solid #eaeaea;
            margin-bottom: 30px;
        }
        
        .logo {
            font-size: 24px;
            font-weight: 700;
            color: #3a86ff;
        }
        
        .logo span {
            color: #ff006e;
        }
        
        nav a {
            text-decoration: none;
            color: #555;
            margin-left: 20px;
            font-weight: 500;
            transition: color 0.3s;
        }
        
        nav a:hover {
            color: #3a86ff;
        }
        
        .page-title {
            font-size: 28px;
            margin-bottom: 10px;
            color: #333;
        }
        
        .page-subtitle {
            color: #666;
            margin-bottom: 30px;
        }
        
        .back-btn {
            display: inline-flex;
            align-items: center;
            color: #3a86ff;
            text-decoration: none;
            font-weight: 500;
            margin-bottom: 20px;
            transition: color 0.3s;
        }
        
        .back-btn:hover {
            color: #2a75ef;
        }
        
        .back-btn i {
            margin-right: 8px;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .small-charts-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .chart-card {
            background: white;
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .chart-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0, 0, 0, 0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }
        
        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .small-chart-container {
            position: relative;
            height: 250px;
            width: 100%;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            text-align: center;
        }
        
        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #3a86ff;
            margin-bottom: 5px;
        }
        
        .stat-label {
            color: #666;
            font-size: 14px;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }
        
        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3a86ff;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }
        
        .error-state {
            text-align: center;
            padding: 30px;
            color: #ff6b6b;
            background: #fff5f5;
            border-radius: 8px;
        }
        
        .no-data {
            text-align: center;
            padding: 40px;
            color: #888;
        }
        
        .no-data i {
            font-size: 48px;
            margin-bottom: 15px;
            color: #ddd;
        }
        
        .filter-section {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 25px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }
        
        .filter-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .filter-select {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            color: #333;
        }
        
        .refresh-btn {
            background: #3a86ff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background 0.3s;
        }
        
        .refresh-btn:hover {
            background: #2a75ef;
        }

        .pie-chart-info {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            font-size: 14px;
        }

        .pie-chart-info h4 {
            margin: 0 0 10px 0;
            color: #333;
            font-size: 16px;
        }

        .job-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .job-item:last-child {
            border-bottom: none;
        }

        .job-name {
            font-weight: 500;
            color: #333;
        }

        .job-percentage {
            font-weight: 600;
            color: #3a86ff;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .chart-container {
                height: 250px;
            }

            .small-chart-container {
                height: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">Edu<span>2</span>Job</div>
            <nav>
                <a href="/">Dashboard</a>
                <a href="/predict-page">Predict</a>
                <a href="/history-page">History</a>
                <a href="/profile-page">Profile</a>
            </nav>
        </header>
        
        <a href="/" class="back-btn">
            <i class="fas fa-arrow-left"></i> Back to Dashboard
        </a>
        
        <h1 class="page-title">Analytics & Visualizations</h1>
        <p class="page-subtitle">Explore your career prediction insights and trends</p>
        
        <!-- Stats Overview -->
        <div class="stats-grid" id="statsGrid">
            <div class="stat-card">
                <div class="stat-value" id="totalPredictions">0</div>
                <div class="stat-label">Total Predictions</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgConfidence">0%</div>
                <div class="stat-label">Average Confidence</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="topJob">-</div>
                <div class="stat-label">Most Predicted Job</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="uniqueJobs">0</div>
                <div class="stat-label">Unique Job Roles</div>
            </div>
        </div>
        
        <!-- Filters -->
        <div class="filter-section">
            <div class="filter-controls">
                <select class="filter-select" id="timeRange">
                    <option value="all">All Time</option>
                    <option value="7">Last 7 Days</option>
                    <option value="30">Last 30 Days</option>
                    <option value="90">Last 3 Months</option>
                </select>
                
                <button class="refresh-btn" onclick="loadVisualizationData()">
                    <i class="fas fa-sync-alt"></i> Refresh Data
                </button>

                <!-- Debug button -->
                <button class="refresh-btn" onclick="testAPIConnection()" style="background: #8338ec;">
                    <i class="fas fa-bug"></i> Test API
                </button>
            </div>
        </div>

        <!-- Top 3 Jobs Pie Chart Section -->
        <div class="small-charts-grid" id="topJobsSection" style="display: none;">
            <div class="chart-card">
                <div class="chart-header">
                    <div class="chart-title">Top 3 Job Predictions Analysis</div>
                </div>
                <div class="small-chart-container">
                    <canvas id="topJobsPieChart"></canvas>
                </div>
                <div class="pie-chart-info" id="pieChartInfo">
                    <!-- Dynamic content will be inserted here -->
                </div>
            </div>
        </div>
        
        <!-- Main Charts Grid -->
        <div class="dashboard-grid" id="chartsGrid">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading your analytics data...</p>
            </div>
        </div>
    </div>

    <script>
        let charts = {};
        let currentUserEmail = 'demo@example.com';
        
        // Test API connection
        async function testAPIConnection() {
            console.log('üîç Testing API connections...');
            
            // Test current user endpoint
            try {
                const userResponse = await fetch('/api/current-user/');
                console.log('üë§ Current User API:', userResponse.status, userResponse.ok);
                if (userResponse.ok) {
                    const userData = await userResponse.json();
                    console.log('User data:', userData);
                    currentUserEmail = userData.email || currentUserEmail;
                }
            } catch (error) {
                console.error('‚ùå Current User API failed:', error);
            }

            // Test visualization data endpoint
            try {
                const vizResponse = await fetch(`/api/visualization-data/${currentUserEmail}/`);
                console.log('üìä Visualization API:', vizResponse.status, vizResponse.ok);
                if (vizResponse.ok) {
                    const vizData = await vizResponse.json();
                    console.log('Visualization data:', vizData);
                } else {
                    console.log('Visualization API response not OK');
                }
            } catch (error) {
                console.error('‚ùå Visualization API failed:', error);
            }

            // Test prediction history endpoint
            try {
                const historyResponse = await fetch('/api/prediction-history/');
                console.log('üìà Prediction History API:', historyResponse.status, historyResponse.ok);
                if (historyResponse.ok) {
                    const historyData = await historyResponse.json();
                    console.log('History data:', historyData);
                }
            } catch (error) {
                console.error('‚ùå Prediction History API failed:', error);
            }

            // Try alternative endpoints
            try {
                const altResponse = await fetch(`/api/history-get/${currentUserEmail}/`);
                console.log('üîÑ Alternative History API:', altResponse.status, altResponse.ok);
                if (altResponse.ok) {
                    const altData = await altResponse.json();
                    console.log('Alternative data:', altData);
                }
            } catch (error) {
                console.error('‚ùå Alternative API failed:', error);
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            // Get current user
            fetch('/api/current-user/')
                .then(response => response.json())
                .then(user => {
                    if (user.email) {
                        currentUserEmail = user.email;
                    }
                    console.log('üë§ Current user:', currentUserEmail);
                    loadVisualizationData();
                })
                .catch(error => {
                    console.log('Using demo user for visualizations:', currentUserEmail);
                    loadVisualizationData();
                });
        });
        
        async function loadVisualizationData() {
            const chartsGrid = document.getElementById('chartsGrid');
            chartsGrid.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading your analytics data...</p>
                </div>
            `;
            
            try {
                console.log(`üìä Loading visualization data for: ${currentUserEmail}`);
                
                // Try multiple endpoints
                let data = null;
                let endpoints = [
                    `/api/visualization-data/${currentUserEmail}/`,
                    `/api/prediction-history/`,
                    `/api/history-get/${currentUserEmail}/`
                ];

                for (let endpoint of endpoints) {
                    try {
                        const response = await fetch(endpoint);
                        if (response.ok) {
                            data = await response.json();
                            console.log(`‚úÖ Success with endpoint: ${endpoint}`, data);
                            break;
                        }
                    } catch (e) {
                        console.log(`‚ùå Failed with endpoint: ${endpoint}`, e);
                    }
                }

                if (!data) {
                    throw new Error('All API endpoints failed');
                }

                // Handle different response formats
                if (data.predictions) {
                    // Format: {predictions: [...]} from prediction-history
                    data = transformPredictionData(data.predictions);
                } else if (Array.isArray(data)) {
                    // Format: [...] from history-get
                    data = transformHistoryData(data);
                }

                if (data.error) {
                    throw new Error(data.error);
                }
                
                // Update stats
                updateStats(data);
                
                // Create Top 3 Jobs Pie Chart
                createTopJobsPieChart(data.job_distribution);
                
                // Render other charts
                renderCharts(data);
                
            } catch (error) {
                console.error('Error loading visualization data:', error);
                chartsGrid.innerHTML = `
                    <div class="error-state">
                        <i class="fas fa-exclamation-triangle"></i>
                        <h3>Unable to Load Data</h3>
                        <p>${error.message}</p>
                        <p><small>Make some predictions first to see analytics.</small></p>
                        <button class="refresh-btn" onclick="loadVisualizationData()" style="margin-top: 15px;">
                            <i class="fas fa-sync-alt"></i> Try Again
                        </button>
                    </div>
                `;
            }
        }

        function createTopJobsPieChart(jobDistribution) {
            // Show the top jobs section
            document.getElementById('topJobsSection').style.display = 'block';
            
            // Get top 3 jobs by count
            const topJobs = [...jobDistribution]
                .sort((a, b) => b.count - a.count)
                .slice(0, 3);

            // If we have less than 3 jobs, fill with sample data
            while (topJobs.length < 3) {
                const sampleJobs = [
                    { job: 'Web Developer', count: 0 },
                    { job: 'Data Scientist', count: 0 },
                    { job: 'Product Manager', count: 0 }
                ];
                topJobs.push(sampleJobs[topJobs.length]);
            }

            const labels = topJobs.map(item => item.job);
            const data = topJobs.map(item => item.count);
            const total = data.reduce((sum, count) => sum + count, 0);
            
            // Calculate percentages
            const percentages = data.map(count => 
                total > 0 ? ((count / total) * 100).toFixed(1) : 0
            );

            // Create pie chart
            const ctx = document.getElementById('topJobsPieChart').getContext('2d');
            
            if (charts.topJobsPie) {
                charts.topJobsPie.destroy();
            }

            charts.topJobsPie = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: [
                            '#3a86ff', // Blue
                            '#ff006e', // Pink
                            '#8338ec'  // Purple
                        ],
                        borderColor: '#fff',
                        borderWidth: 2,
                        hoverOffset: 15
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 20,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const percentage = percentages[context.dataIndex];
                                    return `${label}: ${value} predictions (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });

            // Update pie chart info
            const pieChartInfo = document.getElementById('pieChartInfo');
            pieChartInfo.innerHTML = `
                <h4>Prediction Distribution</h4>
                ${topJobs.map((job, index) => `
                    <div class="job-item">
                        <span class="job-name">${job.job}</span>
                        <span class="job-percentage">${percentages[index]}% (${job.count} predictions)</span>
                    </div>
                `).join('')}
                ${total > 0 ? `
                    <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #ddd;">
                        <strong>Total Predictions: ${total}</strong>
                    </div>
                ` : ''}
            `;
        }

        function transformPredictionData(predictions) {
            // Transform prediction-history format to visualization format
            const confidence_scores = predictions.map(p => ({
                job: p.job,
                confidence: p.confidence,
                date: p.date
            }));

            // Job distribution
            const jobCounts = {};
            predictions.forEach(p => {
                jobCounts[p.job] = (jobCounts[p.job] || 0) + 1;
            });
            const job_distribution = Object.keys(jobCounts).map(job => ({
                job: job,
                count: jobCounts[job]
            }));

            // Skills frequency (simplified)
            const skills_frequency = [
                {skill: 'HTML', count: 8},
                {skill: 'CSS', count: 6},
                {skill: 'JavaScript', count: 7},
                {skill: 'React', count: 5},
                {skill: 'Node.js', count: 4}
            ];

            return {
                confidence_scores,
                job_distribution,
                skills_frequency,
                career_paths: getSampleCareerPaths()
            };
        }

        function transformHistoryData(history) {
            // Transform history-get format to visualization format
            const confidence_scores = history.map(h => ({
                job: h.predicted_job,
                confidence: h.confidence,
                date: h.date
            }));

            // Job distribution
            const jobCounts = {};
            history.forEach(h => {
                jobCounts[h.predicted_job] = (jobCounts[h.predicted_job] || 0) + 1;
            });
            const job_distribution = Object.keys(jobCounts).map(job => ({
                job: job,
                count: jobCounts[job]
            }));

            // Skills frequency
            const skillsList = [];
            history.forEach(h => {
                if (h.skills && Array.isArray(h.skills)) {
                    skillsList.push(...h.skills);
                }
            });
            const skillCounts = {};
            skillsList.forEach(skill => {
                skillCounts[skill] = (skillCounts[skill] || 0) + 1;
            });
            const skills_frequency = Object.keys(skillCounts).map(skill => ({
                skill: skill,
                count: skillCounts[skill]
            })).sort((a, b) => b.count - a.count).slice(0, 10);

            return {
                confidence_scores,
                job_distribution,
                skills_frequency,
                career_paths: getSampleCareerPaths()
            };
        }

        function getSampleCareerPaths() {
            return [
                { major: 'Computer Science', job: 'Software Engineer', count: 8 },
                { major: 'Computer Science', job: 'Data Scientist', count: 4 },
                { major: 'Data Science', job: 'Data Scientist', count: 6 },
                { major: 'Data Science', job: 'ML Engineer', count: 5 },
                { major: 'IT', job: 'Web Developer', count: 7 }
            ];
        }
        
        function updateStats(data) {
            const totalPredictions = data.confidence_scores.length;
            const avgConfidence = totalPredictions > 0 
                ? (data.confidence_scores.reduce((sum, item) => sum + item.confidence, 0) / totalPredictions).toFixed(1)
                : 0;
            
            const uniqueJobs = new Set(data.confidence_scores.map(item => item.job)).size;
            
            // Find most frequent job
            const jobCounts = {};
            data.confidence_scores.forEach(item => {
                jobCounts[item.job] = (jobCounts[item.job] || 0) + 1;
            });
            
            const topJob = Object.keys(jobCounts).length > 0 
                ? Object.keys(jobCounts).reduce((a, b) => jobCounts[a] > jobCounts[b] ? a : b)
                : '-';
            
            document.getElementById('totalPredictions').textContent = totalPredictions;
            document.getElementById('avgConfidence').textContent = avgConfidence + '%';
            document.getElementById('topJob').textContent = topJob;
            document.getElementById('uniqueJobs').textContent = uniqueJobs;
        }
        
        function renderCharts(data) {
            const chartsGrid = document.getElementById('chartsGrid');
            
            if (data.confidence_scores.length === 0) {
                chartsGrid.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-chart-bar"></i>
                        <h3>No Data Available</h3>
                        <p>Make some predictions to see analytics and visualizations.</p>
                        <a href="/predict-page" class="refresh-btn" style="margin-top: 15px; display: inline-block;">
                            Make Your First Prediction
                        </a>
                    </div>
                `;
                return;
            }
            
            chartsGrid.innerHTML = `
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Job Role Distribution</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="jobDistributionChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Confidence Score Trends</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="confidenceChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Top Skills Frequency</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="skillsChart"></canvas>
                    </div>
                </div>
                
                <div class="chart-card">
                    <div class="chart-header">
                        <div class="chart-title">Career Path Analysis</div>
                    </div>
                    <div class="chart-container">
                        <canvas id="careerPathChart"></canvas>
                    </div>
                </div>
            `;
            
            // Destroy existing charts
            Object.values(charts).forEach(chart => {
                if (chart && typeof chart.destroy === 'function' && chart !== charts.topJobsPie) {
                    chart.destroy();
                }
            });
            
            // Create new charts (except topJobsPie which is already created)
            createJobDistributionChart(data.job_distribution);
            createConfidenceChart(data.confidence_scores);
            createSkillsChart(data.skills_frequency);
            createCareerPathChart(data.career_paths);
        }
        
        function createJobDistributionChart(jobData) {
            const ctx = document.getElementById('jobDistributionChart').getContext('2d');
            
            const labels = jobData.map(item => item.job);
            const data = jobData.map(item => item.count);
            
            // Generate colors
            const backgroundColors = generateColors(labels.length);
            
            charts.jobDistribution = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: data,
                        backgroundColor: backgroundColors,
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function createConfidenceChart(confidenceData) {
            const ctx = document.getElementById('confidenceChart').getContext('2d');
            
            // Sort by confidence for better visualization
            const sortedData = [...confidenceData].sort((a, b) => a.confidence - b.confidence);
            
            const labels = sortedData.map((_, index) => `Prediction ${index + 1}`);
            const data = sortedData.map(item => item.confidence);
            const jobLabels = sortedData.map(item => item.job);
            
            charts.confidence = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Confidence Score (%)',
                        data: data,
                        backgroundColor: data.map(score => {
                            if (score >= 80) return '#4CAF50';
                            if (score >= 60) return '#FFC107';
                            return '#F44336';
                        }),
                        borderColor: data.map(score => {
                            if (score >= 80) return '#45a049';
                            if (score >= 60) return '#e6ac00';
                            return '#da190b';
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100,
                            title: {
                                display: true,
                                text: 'Confidence (%)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Predictions'
                            }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                afterLabel: function(context) {
                                    const index = context.dataIndex;
                                    return `Job: ${jobLabels[index]}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        function createSkillsChart(skillsData) {
            const ctx = document.getElementById('skillsChart').getContext('2d');
            
            // Take top 10 skills
            const topSkills = skillsData.slice(0, 10);
            const labels = topSkills.map(item => item.skill);
            const data = topSkills.map(item => item.count);
            
            // FIXED: Use 'bar' type with indexAxis: 'y' instead of deprecated 'horizontalBar'
            charts.skills = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Frequency',
                        data: data,
                        backgroundColor: '#3a86ff',
                        borderColor: '#2a75ef',
                        borderWidth: 1
                    }]
                },
                options: {
                    indexAxis: 'y', // This makes it horizontal
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Frequency'
                            }
                        }
                    }
                }
            });
        }
        
        function createCareerPathChart(careerData) {
            const ctx = document.getElementById('careerPathChart').getContext('2d');
            
            // If no career path data, create sample from job distribution
            const jobData = careerData.length > 0 ? careerData : getSampleCareerPaths();
            
            // Group by major
            const majors = [...new Set(jobData.map(item => item.major))];
            const jobs = [...new Set(jobData.map(item => item.job))];
            
            const datasets = majors.map((major, index) => {
                const color = generateColors(majors.length)[index];
                return {
                    label: major,
                    data: jobs.map(job => {
                        const item = jobData.find(d => d.major === major && d.job === job);
                        return item ? item.count : 0;
                    }),
                    backgroundColor: color,
                    borderColor: color,
                    borderWidth: 1
                };
            });
            
            charts.careerPath = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: jobs,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Job Roles'
                            }
                        },
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Frequency'
                            }
                        }
                    }
                }
            });
        }
        
        function generateColors(count) {
            const colors = [
                '#3a86ff', '#ff006e', '#8338ec', '#fb5607', '#ffbe0b',
                '#06d6a0', '#118ab2', '#ef476f', '#ffd166', '#073b4c',
                '#7209b7', '#f72585', '#4361ee', '#4cc9f0', '#4895ef'
            ];
            return colors.slice(0, count);
        }
        
        // Auto-refresh every 30 seconds
        setInterval(loadVisualizationData, 30000);
    </script>
</body>
</html>